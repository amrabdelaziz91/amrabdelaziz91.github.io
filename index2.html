<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<title>Real Time Updating Map</title>

<!-- Addning Leaflet Style Sheets -->
<link rel="stylesheet" href="CSS/leaflet.css" />

</head>
<style>
    body {
    padding: 0;
    margin: 0;
}
html, body, #map {
    height: 100%;
}
    </style>
<body>
    <div id="map"></div>
<script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>

<script type="application/javascript">

var route, watch, map;

function init() {
	navigator.geolocation.getCurrentPosition(initPosition, handleError);
	watch = navigator.geolocation.watchPosition(updatePosition, handleError);
}

function initPosition(position) {

	var center = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
	var myOptions = {
		zoom: 18,
		center: center,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	};

	map = new google.maps.Map(document.getElementById('map'), myOptions);

	var marker = new google.maps.Marker({
		position: center,
		map: map,
		title:"Start"
	});

	var polyOptions = {
		strokeColor: '#000000',
		strokeOpacity: 1.0,
		strokeWeight: 3
	}

	poly = new google.maps.Polyline(polyOptions);
	poly.setMap(map);

}

function updatePosition(position) {
map.setZoom(17);
        map.panTo(new google.maps.LatLng(
                position.coords.latitude,
                position.coords.longitude
            )); 
	console.log("updatePosition");

	var latLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
	poly.getPath().push(latLng);

	var marker = new google.maps.Marker({
		position: latLng,
		map: map,
		title:"Point"
	});
	
	
}

function handleError(error) {
	alert("Position could not be read:\n" + error.message);
}

init();

    </script>
</body>
</html>
